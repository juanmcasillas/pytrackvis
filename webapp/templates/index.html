{% from "bootstrap5/utils.html" import render_messages %}
{%- extends "base.html" %}

{% block title %}PC  XXX{%- endblock %}


{% block content %}

<div class="pb-2">
    <button type="button" class="btn btn-dark" onclick="load_geojson()">Load track</button>
</div>

<div id="map"></div>
<script>

    const map = (window.map = new maplibregl.Map({
        container: 'map',
        zoom: 14,
        pitch: 45,
        bearing: 0,
        hash: true,
        style: 'https://api.maptiler.com/maps/hybrid/style.json?key=wDVDH3bq9aDZYRws8ami',
        maxZoom: 18,
        maxPitch: 85
    }));

    map.on('load', () => {
        // Add new sources and layers
                        
        map.addControl(new maplibregl.FullscreenControl({container: document.querySelector('body')}),  'top-right');
        map.addControl(
            new maplibregl.NavigationControl({
                visualizePitch: false,
                showZoom: true,
                showCompass: true
            }, 
            'top-right')
        );
        map.addControl(new maplibregl.ScaleControl({ unit: 'metric'}), 'top-right');
        map.addControl(new maplibreGLMeasures.default({}), 'top-right');

        map.addSource("terrain", {
            type: "raster-dem",
            url: `https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=wDVDH3bq9aDZYRws8ami`
        });
        
        map.setTerrain({
            source: "terrain"
        });

        // map.addSource('track33', {
        //     type: "geojson",
        //     data: "http://localhost:8000/garmin-edge-1000-bike.gjson"
        // });

        // map.addLayer({
        //     'id': 'track33_layer',
        //     'type': 'line',
        //     'source': 'track33',
        //     'layout': { 
        //         'line-join': "round", 
        //         'line-cap': "round"
        //     },
        //     'paint': {
        //         'line-color': '#FFFF50', 
        //         'line-width': 4
        //     },
        // });



        map.setCenter({ lon: -4.393035644461469, lat: 40.36047178379049 })
        map.setZoom(15)
    });


function load_geojson() {
    map.addSource('track33', {
        type: "geojson",
        data: "/tracks/get_gjson?id=1"
    });

    map.addLayer({
        'id': 'track33_layer',
        'type': 'line',
        'source': 'track33',
        'layout': { 
            'line-join': "round", 
            'line-cap': "round"
        },
        'paint': {
            'line-color': '#FFFF50', 
            'line-width': 4
        },
    });
}

</script>       

{%- endblock %}
